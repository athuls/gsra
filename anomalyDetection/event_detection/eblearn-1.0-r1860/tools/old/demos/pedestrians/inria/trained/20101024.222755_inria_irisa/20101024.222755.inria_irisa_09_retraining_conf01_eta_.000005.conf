################################################################################
# metarun configuration
# Note: variables starting with "meta_" are reserved for meta configuration

meta_command="mtdetect"
# optional meta variables ######################################################
meta_name=inria_irisa_09_retraining
meta_max_cpus=8
meta_output_dir=/home/sermanet/${machine}data/ped/inria/out
meta_gnuplot_params="set grid ytics;set ytics;set mytics;set grid mytics;set logscale y; set mxtics; set grid xtics; "
# analyze processes output or not. if 0, the meta_trainer will have no notion
# of iteration and will only send 1 report at the very end.
# if 1, meta_trainer will try to find iteration and other variable values
# in each process' output.
meta_analyze=1
meta_send_email=1
meta_email=pierre.sermanet@gmail.com
# iterations at which to send an email
#meta_email_iters=0,1,2,3,4,5,7,10,15,20,30,50,75,100,200
#meta_email_period=1
meta_watch_interval=30
# variables to minimize, process and iteration with lowest value will
# be used to report best weights, or start consequent training
meta_minimize=test_errors,errors,test_energy,energy
meta_ignore_iter0=1
meta_sticky_vars=job,config,classes
meta_send_best=5

################################################################################
# local program configuration

name=inria
machine=${HOSTNAME}a
ebl=${HOME}/eblpierre/
root=/home/sermanet/irisadata/ped/inria/ds/
#root2=/home/sermanet/20101024.222755.inria_irisa/
#root2 = ${ebl}/demos/pedestrians/trained/ # trained weights root

# network ######################################################################
net=0
col=0
net_conf=1
use_diag=1
manual_load=0

net_type0=cscsc
net_type1=cscscf
net_type=cscsc

net_ih=78
net_iw=38
net_c1h=7
net_c1w=7
net_s1h=2
net_s1w=2
net_c2h=7
net_c2w=7
net_s2h=2
net_s2w=2
net_full=20

# network conf 0 ################################################################
net_ih_0=78
net_iw_0=36
net_c1h_0=7
net_c1w_0=7
net_s1h_0=2
net_s1w_0=2
net_c2h_0=7
net_c2w_0=7
net_s2h_0=3
net_s2w_0=3
net_full_0=20

# network conf 1 ################################################################
net_ih_1=78
net_iw_1=38
net_c1h_1=7
net_c1w_1=7
net_s1h_1=2
net_s1w_1=2
net_c2h_1=7
net_c2w_1=7
net_s2h_1=2
net_s2w_1=2
net_full_1=20

absnorm=1
norm_pos=0
color=0
mirror=0
use_tanh=1
use_shrink=0

conv0_table_in = 1
conv0_table_out = 32
conv1_table = ${table1}

# if defined, those variable force to use full connections with those maximums
# (they will be ignored if table0 or table1 are defined)
table0_max=32
#table1_max = 64 # 64 96 128 256

# convolution tables (override table0_max and such)
tblroot=${ebl}/tools/data/tables/
table0_0=
#table0_1 = ${tblroot}/table_3_32_connect_32_fanin_0_density_0.33_yuv0.mat
table0_1=/home/sermanet/eblpierre//tools/data/tables//table_3_32_connect_32_fanin_0_density_0.33_yuv0_y26_u29_v32.mat
tbl1_1=/home/sermanet/eblpierre//tools/data/tables//table_32_64_connect_1664_fanin_26_density_0.81_random.mat
tbl1_2=/home/sermanet/eblpierre//tools/data/tables//table_32_96_connect_2496_fanin_26_density_0.81_random.mat
tbl=1
table0=
table1=${tblroot}/table_32_64_connect_1664_fanin_26_density_0.81_random.mat
#table2 = ${tblroot}/${${tbl}_2}

# manual loading ##############################################################

sp0=
sp1=
wroot0=/data/koray/pedmachines/machine5732
wroot1=/data/koray/pedmachines2/machine95732
#arch=conv,addc,tanh,diag,abs,wstd,subs,conv,addc,tanh,diag,abs,wstd,subs
arch_weights=/data/koray/pedmachines/machine5732_layer1_convolution_kernel.mat,/data/koray/pedmachines/machine5732_layer2_bias_bias.mat,,/data/koray/pedmachines/machine5732_layer4_diag_coeff.mat,,,,/data/koray/pedmachines2/machine95732_layer1_convolution_kernel.mat,/data/koray/pedmachines2/machine95732_layer2_bias_bias.mat,,/data/koray/pedmachines2/machine95732_layer4_diag_coeff.mat,,,,
 
# preprocessing ################################################################
resize=mean
normalization_size=7

# training #####################################################################
ds=1
dsname=inria_mean78x38_ker7_bg
train=8_inria_mean78x38_ker7_bg_train_1
val=8_inria_mean78x38_ker7_bg_val_1
#eta = .000005 .00002 # learning rate
eta=.000005
iterations=20
ndiaghessian=400
epoch_mode=0
epoch_size=4000
epoch_show_modulo=100
train_display=0
sample_probabilities=0
hardest_focus=0
ignore_correct=1
min_sample_weight=0
per_class_norm=1
shuffle_passes=1
balanced_training=1
no_training_test=1
target_factor=1
save_pickings=1
binary_target=0

# retraining ###################################################################
retrain=1
retrain_weights=/home/sermanet/irisadata/ped/inria//out/inria_irisa_20101024.222755//20101024.222755.inria_irisa_06_retraining/best/01/20101024.222755.inria_irisa_06_retraining_conf01_eta_.000005_net014.mat

# detection ####################################################################
nms=1 #1
bbox_file = #bbox.txt # ignore processing, feed pre-computed bboxes to nms
nthreads=1
ipp_cores=1
weights=${root2}/${weights_file}
classes=${root2}/20101024.222755.inria_irisa_09_retraining_conf01_eta_.000005_classes.mat
threshold=.9 #9 # .1
gain=1
input_height=-1
input_width=-1
input_min=0
input_max=200 # 1200
scaling=1.1 # 1.1
min_scale=.55 #1 # .75
max_scale=1
input_random=0
input_npasses=1
bbhfactor=.65 #.745 # .65
bbwfactor=.45 # .6575 # .45
bbhfactor2=1.0534 #1.145 #.745 # .65
bbwfactor2=1.1 # 1.43 #1.46 # .6575 # .45
hzpad=.5
wzpad=.5
#mem_optimization = 1
confidence_type=2
bbox_saving=1
max_bb_overlap=.5
min_hcenter_dist=.3 #.26 # .3
min_wcenter_dist=.15 #.1 # .15
max_object_hratio=0

# detection display ############################################################
skip_frames = 0 # skip this number of frames before each processed frame
save_detections=0
save_max=25000
save_max_per_frame=10
save_video=1
save_video_fps=5
use_original_fps=0
display=1
display_threads=1
display_states=1
show_parts=0
silent=0
sync_outputs=1
minimal_display=0
display_sleep=0
ninternals=1
# demo display variables
queue1=0
qstep1=1
qheight1=5
qwidth1=2
queue2=0
qstep2=50
qheight2=5
qwidth2=5
precamera=0
precamdir=${root2}/

camera=directory
# limit of input video duration in seconds, 0 means no limit
input_video_max_duration=0
# step between input frames in seconds, 0 means no step
input_video_sstep=0

# training-generated variables ####################################################
job_name=20101024.222755.inria_irisa_09_retraining_conf01_eta_.000005 # variable added by metarun
#weights_file=20101024.222755.inria_humaira_00_training_conf16_eta_.000005_sp0_12_sp1_12_net020.mat
#weights_file=20101024.222755.inria_irisa_03_retraining_conf01_eta_.000005_net018.mat
#weights_file=20101024.222755.inria_irisa_06_retraining_conf01_eta_.000005_net014.mat
#weights_file=20101024.222755.inria_irisa_09_retraining_conf01_eta_.000005_net019.mat # variable added by metarun
weights_file=20101024.222755.inria_irisa_12_retraining_conf01_eta_.000005_net015.mat
#weights_file=20101024.222755.inria_irisa_15_retraining_conf01_eta_.000005_net016.mat
#weights_file=20101024.222755.inria_irisa_18_retraining_conf01_eta_.000005_net019.mat 

#input_dir = /home/sermanet/${machine}data/ped/inria/INRIAPerson/Test/pos