<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SenStore Server: Server backup, restore and upgrade</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="index.html">SenStore Server Manual</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>Server backup, restore and upgrade </h1>  </div>
</div>
<div class="contents">
<ul>
<li><a class="el" href="a00003.html#server_backup_sec">Backup procedure</a></li>
<li><a class="el" href="a00003.html#server_restore_sec">Restore procedure</a></li>
<li><a class="el" href="a00003.html#server_upgrade_sec">Upgrade procedure</a></li>
<li><a class="el" href="a00003.html#server_backup_format_sec">Backup File Format</a></li>
</ul>
<h2><a class="anchor" id="server_backup_sec"></a>
Backup procedure</h2>
<p>The SenStoreServer data can be backed up to an independent HDF5 file, for use in other applications, or to restore the SenStoreServer. A backup can be created by running:</p>
<p><code> &gt; python <a class="el" href="a00238.html" title="Database backup script.">scshm_backup.py</a></code></p>
<p>which creates a file <code>backup-senstore-<em>yyyy</em>-<em>mm</em>-<em>dd</em>_<em>hhmm</em>.h5</code>. The backup program is a SenStore client, and can be run from any computer on which the SenStoreServer package is installed, assuming it has access to the running SenStore.</p>
<h2><a class="anchor" id="server_restore_sec"></a>
Restore procedure</h2>
<p>The SenStoreServer data can be restored by running:</p>
<p><code> &gt; python <a class="el" href="a00240.html" title="Database restore script.">scshm_restore.py</a> backup-senstore-<em>yyyy</em>-<em>mm</em>-<em>dd</em>_<em>hhmm</em>.h5</code></p>
<p>Note that this will not overwrite any existing data in the database, as all object/signal/array are created anew, and their IDs are generated by the SenStoreServer. Typically, one would restore data to a fresh re-install of the SenStoreServer, or after clearing all the data (stopping SenStoreServer and running the <a class="el" href="a00239.html" title="Database creation script.">scshm_create.py</a> script). A backup-restore without clearing the database would amount to duplicating all the instances in the database.</p>
<h2><a class="anchor" id="server_upgrade_sec"></a>
Upgrade procedure</h2>
<p>The restoring process (<a class="el" href="a00240.html" title="Database restore script.">scshm_restore.py</a>) attempts to handle any discrepancies between the database definition of the backup file and that of the SenStoreServer. Therefore, the SenStoreServer can be upgraded by taking the following steps:</p>
<ul>
<li>Perform a backup of the current database (existing <a class="el" href="a00238.html" title="Database backup script.">scshm_backup.py</a>)</li>
<li>Stop the server</li>
<li>Install and configure the new server software</li>
<li>Initialize the new database (newly installed <a class="el" href="a00239.html" title="Database creation script.">scshm_create.py</a>)</li>
<li>Start the server (newly installed <a class="el" href="a00241.html" title="Database server start script.">scshm_start.py</a>)</li>
<li>Restore the backup file (newly installed <a class="el" href="a00240.html" title="Database restore script.">scshm_restore.py</a>)</li>
</ul>
<p>The restore procedure includes the following logic:</p>
<ul>
<li>Objects, signals and arrays that do not exist in the SenStoreServer database definition are ignored and not restored.</li>
<li>All object/signal/array IDs are generated by the SenStoreServer.</li>
<li>Any object/signal/array member that does not exist in the SenStoreServer is ignored.</li>
<li>Any object/signal/array member that does not exist in the backup file will be set to the default value.</li>
<li>All local object/signal/array references are mapped to the database IDs.</li>
<li>All enumeration values are mapped using the database enumeration label. This allows for inserting new labels in the database definition.</li>
</ul>
<p>Note that a changed type of existing object members in a newer SenStoreServer version will most likely cause the restore to fail. In those cases it is necessary to write a backup file converter that handles mapping the values.</p>
<h2><a class="anchor" id="server_backup_format_sec"></a>
Backup File Format</h2>
<p>The complete data of the SenStoreServer is backed up to a single HDF5 file (note that the SenStoreServer stores part of the data in PostgreSQL, and part in HDF5). The layout of the HDF5 backup file is detailed below:</p>
<ul>
<li><code>/enums/<em>enumname</em></code> HDF5 Table with numeration definitions</li>
<li><code>/objects/<em>classname</em></code> HDF5 Table with object, signal and array instance member data</li>
<li><code>/arrays/<em>classname</em>/id<em>#id</em>/data</code> HDF5 Array with SenStore array instance data values</li>
<li><code>/arrays/<em>classname</em>/id<em>#id</em>/<em>axis</em>Axis</code></li>
<li><code>/signals/<em>classname</em>/id<em>#id</em>/data</code> HDF5 Array with SenStore signal instance data values</li>
<li><code>/signals/<em>classname</em>/id<em>#id</em>/<em>axis</em>Axis</code> HDF5 Array with SenStore signal instance axis values (note that <code>time</code> is the signal time axis)</li>
</ul>
<p>Object IDs, references and enumerations are mapped to local IDs in the HDF5 files:</p>
<ul>
<li>The database object/signal/array IDs are used for the local ID as well.</li>
<li>All object/signal/array references (i.e. data members and axes values referencing another object) are mapped to the local object/signal/array IDs.</li>
<li>All enumeration values (i.e. data members and axes values) are mapped to the local enumeration index.</li>
</ul>
<p>The object/signal/array data members for each class are stored in a single HDF5 Table, where the local object ID is stored in the <code>id</code> field, and the other fields under their corresponding name. The axis and data of signals and arrays are stored for each signal/array instance separately. For example, the signal time axis of the <a class="el" href="a00007.html" title="Implementation of AccelMeas servant.">scshm.database.server.SenStoreServer.AccelMeasI</a> instance with <code>id=5</code> is stored in </p>
<div class="fragment"><pre class="fragment">
  /signals/AccelMeas/id5/time
</pre></div><p> and its <code>Direction</code> axis in </p>
<div class="fragment"><pre class="fragment">
  /signals/AccelMeas/id5/DirectionAxis
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>The backup file does not include a schema of the database, and references are not explicitly defined (they are stored as integer object IDs). Knowledge of the schema is needed to know which enumeration or object/signal/array class a reference field refers to. </dd></dl>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Sep 7 2010 11:34:36 for SenStore Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
